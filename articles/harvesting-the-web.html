<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harvesting the web with rvest • rvest</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../.css" rel="stylesheet">
<meta property="og:title" content="Harvesting the web with rvest">
<meta property="og:description" content="rvest">
<meta property="og:image" content="https://rvest.tidyverse.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">rvest</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.6.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/harvesting-the-web.html">Harvesting the web with rvest</a>
    </li>
    <li>
      <a href="../articles/selectorgadget.html">SelectorGadget</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/rvest/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="harvesting-the-web_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="harvesting-the-web_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="harvesting-the-web_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Harvesting the web with rvest</h1>
                        <h4 class="author">Dmytro Perepolkin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/rvest/blob/master/vignettes/harvesting-the-web.Rmd"><code>vignettes/harvesting-the-web.Rmd</code></a></small>
      <div class="hidden name"><code>harvesting-the-web.Rmd</code></div>

    </div>

    
    
<style>
img {
border: 0px;
outline: 0 ;
}
</style>
<div id="introduction-to-html-elements" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-html-elements" class="anchor"></a>Introduction to HTML elements</h2>
<p>HTML stand for “Hyper Text Markup Language”. HTML page consists of series of elements which browsers use to interpret how to display the content. HTML tags are names of the elements surrounded by angle brackets like so: <code>&lt;tagname&gt; content goes here... &lt;/tagname&gt;</code>. Most HTML tags come in pairs and consist of opening and a closing tag, known as <em>start tag</em> and <em>end tag</em>, where the <em>end tag</em> name is preceded by the forward slash <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>.</p>
<p>Below is a visualization of a simple HTML page structure:</p>
<p><img src="harvesting-web-1-s.png" width="481" height="540"></p>
<p>It is possible to define HTML attributes inside HTML tags. Attributes provide additional information about HTML elements, such as hyperlinks for text, and width and height for images. Attributes are always defined in the start tag and come in <code>name="value"</code> pairs, like so: <code>&lt;a href="https://www.example.com"&gt;This is a link&lt;/a&gt;</code></p>
<p>You can learn more about HTML tags and attributes from online resources, such as <a href="https://www.w3schools.com/html/default.asp">W3schools</a></p>
</div>
<div id="css-selectors" class="section level2">
<h2 class="hasAnchor">
<a href="#css-selectors" class="anchor"></a>CSS Selectors</h2>
<p>CSS is a language that describes how HTML elements should be displayed. One of the ways to define useful shortcuts for selecting HTML elements to style is <strong>CSS selectors</strong>. CSS selectors represent <em>patterns</em> for locating HTML elements. They can be used not only for styling, but also for extracting the content of these elements. SelectorGadget (see <code><a href="../articles/selectorgadget.html">vignette("selectorgadget")</a></code>) implements a quick way of plucking HTML elements using CSS selectors.</p>
<p>Lets have a look at the IMDB page for the <a href="https://www.imdb.com/title/tt1490017/">Lego Movie</a> and inspect the content of the page behind the fist entry in the Cast table. You can right-click the element you want to inspect and select Inspect or Inspect Element, depending on your browser.</p>
<p><img src="harvesting-web-2-s.png" width="509" height="540"></p>
<p>This will open Developer Tools with the Elements tab containing full HTML content of the page in the tree view, focused on the element you chose to inspect.</p>
<p><img src="harvesting-web-3-s.png" width="height="></p>
<p>Two of very common HTML attributes are <code>class</code> and <code>id</code>. They are used for grouping and identifying HTML tags. In the screenshot above you can find examples of both of them.</p>
<p>The tags containing <code>class</code> attribute can be selected using <code>.</code> followed by the name of the class. For example, you can open SelectorGadget and try selecting tags with classes “odd”(or “even”) like so:</p>
<p><img src="harvesting-web-4-s.png" width="height="></p>
<p>In order to search inside specific tag, selectors can be separated by space. Here, for example, we are locating tags with class “character” inside tags with class “odd” (i.e. we are searching for tags with class “character” among the descendants of tags with class “odd”).</p>
<p><img src="harvesting-web-5-s.png" width="height="></p>
<p>Another useful selector is for tags with a special attribute “id”. Selector for the tags with this attribute can be composed with symbol <code>#</code> prepending the attribute value. This selector can be combined with another one as in the example below.</p>
<p><img src="harvesting-web-6-s.png" width="height="></p>
<p>Other tags can be simply identified by name. SelectorGadget will usually do a fairly good job guessing CSS selector combination, but you can always inspect the page and adjust CSS selector as needed. Here’s more realistic example of CSS selector suggested by SelectorGadget (from <code>vignette("selectogadget")</code>) which might be interpreted as: “Select tag <code>a</code> which is descendant of a tag <code>td</code> immediately following a tag with a class set to <code>.primary_photo</code>”.</p>
<p><img src="harvesting-web-7-s.png" width="height="></p>
<p>The tag with <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign indicates that we are interested not in the one identified by the selector, but the one “immediately following” it. In the example above, the tag containing the actor name does not have the “class” attribute, but it is located between (on the same level with) two other <code>td</code> tags: <code>td</code> tag with class set to <code>primary_photo</code> and <code>td</code> tag with class set to <code>character</code>. Therefore, SelectorGadget suggested the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> syntax to locate the exact tag we need.</p>
<p>Overview of other useful CSS selectors can be found online, for example <a href="https://www.w3schools.com/cssref/css_selectors.asp">here</a></p>
</div>
<div id="extracting-html-elements-with-css" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-html-elements-with-css" class="anchor"></a>Extracting HTML elements with CSS</h2>
<p>Once the required section of the HTML document is located, it can be extracted with <code>rvest</code>. Let’s look at the IMDB page for the <a href="https://www.imdb.com/title/tt1490017/">Lego Movie</a> and extract the names of the characters the actors play.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: xml2</span>
<span class="va">lego_url</span> <span class="op">&lt;-</span> <span class="st">"http://www.imdb.com/title/tt1490017/"</span>
<span class="va">html</span> <span class="op">&lt;-</span> <span class="fu">read_html</span><span class="op">(</span><span class="va">lego_url</span><span class="op">)</span>

<span class="va">characters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/html_nodes.html">html_nodes</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">characters</span><span class="op">)</span>
<span class="co">#&gt; [1] 15</span>

<span class="va">characters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
<span class="co">#&gt; {xml_nodeset (2)}</span>
<span class="co">#&gt; [1] &lt;td class="character"&gt;\n            &lt;a href="/title/tt1490017/characters/ ...</span>
<span class="co">#&gt; [2] &lt;td class="character"&gt;\n            &lt;a href="/title/tt1490017/characters/ ...</span>
<span class="fu"><a href="../reference/html_text.html">html_text</a></span><span class="op">(</span><span class="va">characters</span>, trim<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Batman /  \n            Bruce Wayne \n  \n  \n  (voice)"                                                </span>
<span class="co">#&gt;  [2] "Wyldstyle /  \n            Lucy \n  \n  \n  (voice)"                                                    </span>
<span class="co">#&gt;  [3] "Blake /  \n            Additional Voices \n  \n  \n  (voice)"                                           </span>
<span class="co">#&gt;  [4] "Unikitty \n  \n  \n  (voice)"                                                                           </span>
<span class="co">#&gt;  [5] "Octan Robot /  \n            Additional Voices \n  \n  \n  (voice)"                                     </span>
<span class="co">#&gt;  [6] "C-3PO \n  \n  \n  (voice)"                                                                              </span>
<span class="co">#&gt;  [7] "Benny \n  \n  \n  (voice)"                                                                              </span>
<span class="co">#&gt;  [8] "Mom \n  \n  \n  (voice)"                                                                                </span>
<span class="co">#&gt;  [9] "Han Solo \n  \n  \n  (voice)"                                                                           </span>
<span class="co">#&gt; [10] "Lord Business /  \n            President Business /  \n            The Man Upstairs \n  \n  \n  (voice)"</span>
<span class="co">#&gt; [11] "Abraham Lincoln \n  \n  \n  (voice) (as Orville Forte)"                                                 </span>
<span class="co">#&gt; [12] "Wally \n  \n  \n  (voice)"                                                                              </span>
<span class="co">#&gt; [13] "Vitruvius \n  \n  \n  (voice)"                                                                          </span>
<span class="co">#&gt; [14] "Gandalf /  \n            Additional Voices \n  \n  \n  (voice)"                                         </span>
<span class="co">#&gt; [15] "Green Lantern \n  \n  \n  (voice)"</span></code></pre></div>
<p><code>rvest</code> contains a few handy functions for accessing different attributes of the currently selected nodes. For example, we can access names of the selected tags with <code><a href="../reference/html_text.html">html_name()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_nodes</a></span><span class="op">(</span><span class="va">html</span>,<span class="st">".cast_list"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_name</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "table"</span></code></pre></div>
<p>Most of the time we want to use <code><a href="../reference/html_nodes.html">html_nodes()</a></code> (returning <code>xml nodeset</code>) to make sure we capture all matches, but in those cases when we know that there is only one single match or when we only care about the first match, we can use <code><a href="../reference/html_nodes.html">html_node()</a></code>, which returns single <code>xml node</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>,<span class="st">".cast_list"</span><span class="op">)</span>
<span class="co">#&gt; {html_node}</span>
<span class="co">#&gt; &lt;table class="cast_list"&gt;</span>
<span class="co">#&gt;  [1] &lt;tr&gt;&lt;td colspan="4" class="castlist_label"&gt;Cast overview, first billed o ...</span>
<span class="co">#&gt;  [2] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0004715/? ...</span>
<span class="co">#&gt;  [3] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0006969/ ...</span>
<span class="co">#&gt;  [4] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm1911947/? ...</span>
<span class="co">#&gt;  [5] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm1555340/ ...</span>
<span class="co">#&gt;  [6] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0123262/? ...</span>
<span class="co">#&gt;  [7] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0000355/ ...</span>
<span class="co">#&gt;  [8] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0206359/? ...</span>
<span class="co">#&gt;  [9] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm5322950/ ...</span>
<span class="co">#&gt; [10] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm1584992/? ...</span>
<span class="co">#&gt; [11] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0002071/ ...</span>
<span class="co">#&gt; [12] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0287182/? ...</span>
<span class="co">#&gt; [13] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm2002649/ ...</span>
<span class="co">#&gt; [14] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm0000151/? ...</span>
<span class="co">#&gt; [15] &lt;tr class="even"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm3025399/ ...</span>
<span class="co">#&gt; [16] &lt;tr class="odd"&gt;\n&lt;td class="primary_photo"&gt;\n&lt;a href="/name/nm1706767/? ...</span></code></pre></div>
<p>If the name of the current tag is <code>table</code> (both as single <code>xml node</code>, but also as <code>xml nodeset</code> of tables) it can usually be parsed into a data.frame automatically (either as a single data.frame or as a list of data.frames, for <code>xml node</code> and <code>xml nodeset</code>, respectively).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>,<span class="st">".cast_list"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;                                  X1                                X2</span>
<span class="co">#&gt; 1 Cast overview, first billed only: Cast overview, first billed only:</span>
<span class="co">#&gt; 2                                                         Will Arnett</span>
<span class="co">#&gt; 3                                                     Elizabeth Banks</span>
<span class="co">#&gt; 4                                                         Craig Berry</span>
<span class="co">#&gt; 5                                                         Alison Brie</span>
<span class="co">#&gt; 6                                                       David Burrows</span>
<span class="co">#&gt;                                  X3</span>
<span class="co">#&gt; 1 Cast overview, first billed only:</span>
<span class="co">#&gt; 2                               ...</span>
<span class="co">#&gt; 3                               ...</span>
<span class="co">#&gt; 4                               ...</span>
<span class="co">#&gt; 5                               ...</span>
<span class="co">#&gt; 6                               ...</span>
<span class="co">#&gt;                                                                   X4</span>
<span class="co">#&gt; 1                                  Cast overview, first billed only:</span>
<span class="co">#&gt; 2            Batman /  \n            Bruce Wayne \n  \n  \n  (voice)</span>
<span class="co">#&gt; 3                Wyldstyle /  \n            Lucy \n  \n  \n  (voice)</span>
<span class="co">#&gt; 4       Blake /  \n            Additional Voices \n  \n  \n  (voice)</span>
<span class="co">#&gt; 5                                       Unikitty \n  \n  \n  (voice)</span>
<span class="co">#&gt; 6 Octan Robot /  \n            Additional Voices \n  \n  \n  (voice)</span></code></pre></div>
<p>The most basic content in HTML is text. It can be located between the opening and the closing tag of the “tag bracket” (sometimes along with other “descendant” tags). The text (from current and all “children” tags) can be extracted with <code><a href="../reference/html_text.html">html_text()</a></code>. Lets extract text out of the first character node.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_text</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "\n            Batman /  \n            Bruce Wayne \n  \n  \n  (voice)\n  \n                  \n          "</span></code></pre></div>
<p>Finally attributes of HTML tags can be extracted using <code><a href="../reference/html_text.html">html_attrs()</a></code>(or <code><a href="../reference/html_text.html">html_attr()</a></code> for extracting a single attribute from a node/nodeset, given its name). Let’s fetch urls of the actors’ pages.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_nodes</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_children</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_attr</a></span><span class="op">(</span><span class="st">"href"</span><span class="op">)</span>
<span class="co">#&gt;  [1] "/title/tt1490017/characters/nm0004715?ref_=tt_cl_t1" </span>
<span class="co">#&gt;  [2] "/title/tt1490017/characters/nm0004715?ref_=tt_cl_t1" </span>
<span class="co">#&gt;  [3] "/title/tt1490017/characters/nm0006969?ref_=tt_cl_t2" </span>
<span class="co">#&gt;  [4] "/title/tt1490017/characters/nm0006969?ref_=tt_cl_t2" </span>
<span class="co">#&gt;  [5] "/title/tt1490017/characters/nm1555340?ref_=tt_cl_t4" </span>
<span class="co">#&gt;  [6] "/title/tt1490017/characters/nm0206359?ref_=tt_cl_t7" </span>
<span class="co">#&gt;  [7] "/title/tt1490017/characters/nm0002071?ref_=tt_cl_t10"</span>
<span class="co">#&gt;  [8] "/title/tt1490017/characters/nm0002071?ref_=tt_cl_t10"</span>
<span class="co">#&gt;  [9] "/title/tt1490017/characters/nm0002071?ref_=tt_cl_t10"</span>
<span class="co">#&gt; [10] "/title/tt1490017/characters/nm0287182?ref_=tt_cl_t11"</span>
<span class="co">#&gt; [11] "/title/tt1490017/characters/nm0000151?ref_=tt_cl_t13"</span>
<span class="co">#&gt; [12] "/title/tt1490017/characters/nm3025399?ref_=tt_cl_t14"</span>
<span class="co">#&gt; [13] "/title/tt1490017/characters/nm3025399?ref_=tt_cl_t14"</span>
<span class="co">#&gt; [14] "/title/tt1490017/characters/nm1706767?ref_=tt_cl_t15"</span></code></pre></div>
</div>
<div id="extracting-html-elements-with-xpath" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-html-elements-with-xpath" class="anchor"></a>Extracting HTML elements with xpath</h2>
<p>Alternative way of extracting HTML elements is using <code>xpath</code> argument in <code><a href="../reference/html_nodes.html">html_node()</a></code> or <code><a href="../reference/html_nodes.html">html_nodes()</a></code>, which allows specifying expressions to extract individual nodes or nodesets. <code>XPath</code> (XML Path Language) is a query language for selecting nodes from an XML document. It is much more powerful than CSS selectors, but its syntax is also more terse.</p>
<p>Say we want to extract text from the character column of the Cast table, but only the text without hyperlinks. If we look closer, we will see that the first <code>td</code> node of class <code>character</code> has two children nodes <code>a</code> interleaved with plain text in the following sequence:</p>
<ul>
<li>node <code>a</code> containing word “Batman” with hyperlink</li>
<li>text “/” (forward slash sign)</li>
<li>node <code>a</code> containing words “Bruce Wayne” with another hyperlink</li>
<li>text “(voice)”</li>
</ul>
<p><img src="harvesting-web-8-s.png" width="height="></p>
<p>The following <code>rvest</code> code will separate “children” text from “parent” text and return only text from the “child” node(s).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_children</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_text</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Batman"      "Bruce Wayne"</span></code></pre></div>
<p>However, there’s no suitable “CSS selector” to exclude child nodes and extract only text from the “parent” node. This is the situation where <code>xpath</code> selector can be more powerful. In addition to traversing the html/xml tree, <code>xpath</code> also has its own “extractor” functions, similar to those of <code>rvest</code>. In particular, here will will use <code><a href="https://rdrr.io/r/graphics/text.html">text()</a></code> applied to “current node only” (this is the meaning of <code>./</code> in the following code). We also use <code>normalize-space()</code> function, which drops empty strings.</p>
<p>Note that the <code>xpath</code> internal function <code><a href="https://rdrr.io/r/graphics/text.html">text()</a></code> has simplified the content, but <code><a href="../reference/html_nodes.html">html_nodes()</a></code> is unaware of it and still returns <code>xml_nodeset</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_nodes.html">html_nodes</a></span><span class="op">(</span>xpath<span class="op">=</span><span class="st">"./text()[normalize-space()]"</span><span class="op">)</span>
<span class="co">#&gt; {xml_nodeset (2)}</span>
<span class="co">#&gt; [1]  /  \n            </span>
<span class="co">#&gt; [2]  \n  \n  \n  (voice)\n  \n                  \n</span></code></pre></div>
<p>We can now simplify this output and return values in a normal list.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/html_nodes.html">html_node</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">".cast_list .character"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_nodes.html">html_nodes</a></span><span class="op">(</span>xpath<span class="op">=</span><span class="st">"./text()[normalize-space()]"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/html_text.html">html_text</a></span><span class="op">(</span>trim<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] "/"       "(voice)"</span></code></pre></div>
<p>Please, refer to <a href="https://www.w3schools.com/xml/xpath_syntax.asp">XPath syntax reference here</a> to learn more how to compose and use <code>xpath</code> to locate elements inside HTML tree.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>rvest is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
